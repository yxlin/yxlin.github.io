<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>Three-accumulator LBA Model | Cognitive Models</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="Three-accumulator LBA Model" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We have striven to minimize the number of errors. However, we canot guarantee the note is 100% accurate. We have updated the predict_one function for S4 class (19/01/2020). This update is tested on Ubuntu 18.04.3 LTS (Intel® Core™ i5-8400 CPU @ 2.80GHz × 6; Memory: 7.7 GB)" />
<meta property="og:description" content="We have striven to minimize the number of errors. However, we canot guarantee the note is 100% accurate. We have updated the predict_one function for S4 class (19/01/2020). This update is tested on Ubuntu 18.04.3 LTS (Intel® Core™ i5-8400 CPU @ 2.80GHz × 6; Memory: 7.7 GB)" />
<link rel="canonical" href="http://localhost:4000/cognitive-model/lba3/" />
<meta property="og:url" content="http://localhost:4000/cognitive-model/lba3/" />
<meta property="og:site_name" content="Cognitive Models" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-10-03T06:11:35+00:00" />
<script type="application/ld+json">
{"datePublished":"2020-10-03T06:11:35+00:00","description":"We have striven to minimize the number of errors. However, we canot guarantee the note is 100% accurate. We have updated the predict_one function for S4 class (19/01/2020). This update is tested on Ubuntu 18.04.3 LTS (Intel® Core™ i5-8400 CPU @ 2.80GHz × 6; Memory: 7.7 GB)","@type":"Article","url":"http://localhost:4000/cognitive-model/lba3/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/siteicon.png"}},"headline":"Three-accumulator LBA Model","dateModified":"2020-10-03T06:11:35+00:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Cognitive Models" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		
	</head>

	<body>
	  <header>
	    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>
	    
			<h1>
				<a href="/"><img src="/images/emblem.svg" width="40" height="40" alt="Cognitive Models logo"></a>
				Cognitive Models
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav >
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/"></a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/BUGS/hnormal/">BUGS Examples Volumn 1</a>
							<ul>
								
									<li class="nav-item "><a href="/BUGS/hnormal/">Hierarchical Normal Model</a></li>
								
									<li class="nav-item "><a href="/BUGS/seeds/">Random effect logistic regression</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/approximation/kde/">Likelihood Free Method</a>
							<ul>
								
									<li class="nav-item "><a href="/approximation/kde/">Kernel Density Estimation</a></li>
								
									<li class="nav-item "><a href="/approximation/pda/">Probability Density Approximation</a></li>
								
									<li class="nav-item "><a href="/approximation/ppda/">Parallel Probability Density Approximation</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/basics/model_array/">Modelling Basics</a>
							<ul>
								
									<li class="nav-item "><a href="/basics/model_array/">Model Array</a></li>
								
									<li class="nav-item "><a href="/basics/simulation/">Simulation</a></li>
								
									<li class="nav-item "><a href="/basics/descriptive/">Descriptive Statistics</a></li>
								
									<li class="nav-item "><a href="/basics/summary/">Summary Statistics</a></li>
								
									<li class="nav-item "><a href="/basics/leastsq/">Least Square Method</a></li>
								
									<li class="nav-item "><a href="/basics/mle/">Maximising Likelihoods</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/bayes-basics/theorem/">Bayesian Basics</a>
							<ul>
								
									<li class="nav-item "><a href="/bayes-basics/theorem/">Bayes' Theorem</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/prior/">Prior Distribution</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/likelihood/">Model Likelihood</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/posterior/">Posterior Distribution</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/diagnosis/">Checking Fitted Models</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/cognitive-model/lba/">Cognitive Model</a>
							<ul>
								
									<li class="nav-item "><a href="/cognitive-model/lba/">LBA Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/pm/">PM Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/plba/">PLBA Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/ddm/">Diffusion Decision Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/ddm1c/">One-choice Diffusion Decision Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/cddm/">Circular Drift-diffusion Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/pddm/">PDDM</a></li>
								
									<li class="nav-item current"><a href="/cognitive-model/lba3/">Three-accumulator LBA Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/lca/">LCA Model</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/fixed-effect-model/one_participant/">Fixed-effects Model</a>
							<ul>
								
									<li class="nav-item "><a href="/fixed-effect-model/one_participant/">One Participant</a></li>
								
									<li class="nav-item "><a href="/fixed-effect-model/many_participants/">Multiple Participants</a></li>
								
									<li class="nav-item "><a href="/fixed-effect-model/cddm12S/">CDDM</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/mcmc/mcmc/">Modern Bayesian Statistics</a>
							<ul>
								
									<li class="nav-item "><a href="/mcmc/mcmc/">Markov Chain Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/mcmc/rwm/">Random Walk Metropolis</a></li>
								
									<li class="nav-item "><a href="/mcmc/hastings/">Metropolis-Hastings</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/random-effect-model/hlba/">Hierarchical Model</a>
							<ul>
								
									<li class="nav-item "><a href="/random-effect-model/hlba/">HLBA Model</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/hddm/">HDDM</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/shooting-decision1/">Shooting Decision Model - Recovery Study</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/shooting-decision2/">Shooting Decision Model - Empirical Data</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/hcddm/">HCDDM</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/hpm/">HPM Model</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/sampling/genetic/">Sampling Techniques</a>
							<ul>
								
									<li class="nav-item "><a href="/sampling/genetic/">Population-based Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/sampling/crossover/">Crossover</a></li>
								
									<li class="nav-item "><a href="/sampling/migration/">Migration</a></li>
								
									<li class="nav-item "><a href="/sampling/mutation/">Mutation</a></li>
								
									<li class="nav-item "><a href="/sampling/demc/">Differential Evolution Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/sampling/demcmc/">Differential Evolution Markov Chain Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/sampling/dgmc/">Distributed Genetic Monte Carlo</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Cognitive Model</h2>
				<h3>Three-accumulator LBA Model</h3>
			</div>
			<article class="content">
				<blockquote>
  <ol>
    <li>We have striven to minimize the number of errors. However, we canot 
guarantee the note is 100% accurate.</li>
    <li>We have updated the predict_one function for S4 class (19/01/2020).</li>
    <li>This update is tested on Ubuntu 18.04.3 LTS (Intel® Core™ i5-8400 CPU @ 2.80GHz × 6; Memory: 7.7 GB)</li>
  </ol>
</blockquote>

<p>This is a quick note for fitting 3-accumulator LBA model. First, some pre-analysis set up work.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## version 0.2.7.8
## devtools::install_github("yxlin/ggdmc")
loadedPackages &lt;-c("ggdmc", "data.table", "ggplot2", "gridExtra", "ggthemes")
sapply(loadedPackages, require, character.only=TRUE)

## A function for generating posterior predictive samples for one participant fit
predict_one &lt;- function(object, npost = 100, xlim = NA, seed = NULL)
{
    facs   &lt;- attr(object@dmi@model, "factors"); 
    fnames &lt;- names(facs); 
    ns &lt;- table( object@dmi@data[, fnames], dnn = fnames)
    nsample &lt;- object@nchain * object@nmc; 
    pnames &lt;- object@pnames; 

    thetas &lt;- matrix(aperm(object@theta, c(3,2,1)), ncol = object@npar)
    colnames(thetas) &lt;- pnames
  
    if (is.na(npost)) stop("Must specify npost!")
    
    use    &lt;- sample(1:nsample, npost, replace = FALSE); 
    npost  &lt;- length(use)
    posts  &lt;- thetas[use, ]
    ntrial &lt;- sum(ns) 
    v &lt;- lapply(1:npost, function(i) {
        simulate(object@dmi@model, nsim = ns, ps = posts[i,], seed = seed)
    })
    out &lt;- data.table::rbindlist(v)
    reps &lt;- rep(1:npost, each = ntrial)
    out &lt;- cbind(reps, out)
  
    if (!any(is.na(xlim))) out &lt;- out[RT &gt; xlim[1] &amp; RT &lt; xlim[2]]
    attr(out, "data") &lt;- object@dmi
    return(out)
}
  
</code></pre></div></div>

<p>In this example, we assumed three accumulators corresponding to three responses. Let’s say they are “Word”, “Nonword”, and “Pseudo-word”. They are coded respectively as W, N and P. This is to assume we had run some (visual) lexical-decision experiments, instructing participants to decide whether a stimulus is a word, a non-word, or a make-up word. The three types of stimuli are coded as ww, nn and pn.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">model</span> <span class="p">&lt;-</span> <span class="n">BuildModel</span><span class="p">(</span>
  <span class="n">p</span><span class="p">.</span><span class="n">map</span>     <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">A</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">B</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">t0</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">mean_v</span> <span class="p">=</span> <span class="s2">"R"</span><span class="p">,</span> <span class="n">sd_v</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span>
                   <span class="n">st0</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">),</span>
  <span class="n">match</span><span class="p">.</span><span class="n">map</span> <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">M</span> <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">ww</span> <span class="p">=</span> <span class="s2">"W"</span><span class="p">,</span> <span class="n">nn</span> <span class="p">=</span> <span class="s2">"N"</span><span class="p">,</span> <span class="n">pn</span> <span class="p">=</span> <span class="s2">"P"</span><span class="p">)),</span>
  <span class="n">factors</span>   <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">S</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"ww"</span><span class="p">,</span> <span class="s2">"nn"</span><span class="p">,</span> <span class="s2">"pn"</span><span class="p">)),</span>
  <span class="n">constants</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">st0</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">sd_v</span> <span class="p">=</span> <span class="m">1</span><span class="p">),</span>
  <span class="n">responses</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"W"</span><span class="p">,</span> <span class="s2">"N"</span><span class="p">,</span> <span class="s2">"P"</span><span class="p">),</span>
  <span class="n">type</span>      <span class="p">=</span> <span class="s2">"norm"</span><span class="p">)</span>
<span class="p">##</span> <span class="n">Parameter</span> <span class="n">vector</span> <span class="n">names</span> <span class="n">are</span><span class="p">:</span> <span class="p">(</span> <span class="n">see</span> <span class="n">attr</span><span class="p">(,</span><span class="s2">"p.vector"</span><span class="p">)</span> <span class="p">)</span>
<span class="p">##</span> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s2">"A"</span>        <span class="s2">"B"</span>        <span class="s2">"t0"</span>       <span class="s2">"mean_v.W"</span> <span class="s2">"mean_v.N"</span> <span class="s2">"mean_v.P"</span>
<span class="p">##</span> 
<span class="p">##</span> <span class="n">Constants</span> <span class="n">are</span> <span class="p">(</span><span class="n">see</span> <span class="n">attr</span><span class="p">(,</span><span class="s2">"constants"</span><span class="p">)</span> <span class="p">):</span>
<span class="p">##</span>  <span class="n">st0</span> <span class="n">sd_v</span> 
<span class="p">##</span>    <span class="m">0</span>    <span class="m">1</span> 
<span class="p">##</span> 
<span class="p">##</span> <span class="k">Model</span> <span class="n">type</span> <span class="p">=</span> <span class="n">norm</span> <span class="p">(</span><span class="n">posdrift</span> <span class="p">=</span> <span class="nb">TRUE</span> <span class="p">)</span> 
</code></pre></div></div>

<p>Firstly, as usual, we conducted a small recovery study. That is, we designated
a parameter vector with specific values and on the basis of this particular
parameter vector, we simulated a data set and fit such data set with the
model to see if it could recover the values reasonably well.</p>

<p>For now, we will show only the recovery study.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p.vector &lt;- c(A = 1.25, B = .25, t0 = .2, mean_v.W = 2.5, mean_v.N = 1.5,
              mean_v.P = 1.2)

## ggdmc adapts print function to help inspect model
print(model)

## The model array is huge
## W 
##         A    B   t0 mean_v.W mean_v.N mean_v.P sd_v  st0
## ww.W TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## nn.W TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## pn.W TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## ww.N TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## nn.N TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## pn.N TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## ww.P TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## nn.P TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## pn.P TRUE TRUE TRUE     TRUE    FALSE    FALSE TRUE TRUE
## N 
##         A    B   t0 mean_v.W mean_v.N mean_v.P sd_v  st0
## ww.W TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## nn.W TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## pn.W TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## ww.N TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## nn.N TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## pn.N TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## ww.P TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## nn.P TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## pn.P TRUE TRUE TRUE    FALSE     TRUE    FALSE TRUE TRUE
## P 
##         A    B   t0 mean_v.W mean_v.N mean_v.P sd_v  st0
## ww.W TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## nn.W TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## pn.W TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## ww.N TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## nn.N TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## pn.N TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## ww.P TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## nn.P TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## pn.P TRUE TRUE TRUE    FALSE    FALSE     TRUE TRUE TRUE
## The model object carries this many attributes
## Attributes: 
##  [1] "dim"        "dimnames"   "all.par"    "p.vector"   "par.names"  "type"       "factors"
##  [8] "responses"  "constants"  "posdrift"   "n1.order"   "match.cell" "match.map"  "is.r1"
## [15] "class"


print(model, p.vector)
## The following is how ggdmc allocates the parameters to each accumulator.
## [1] "ww.W"
##      A   b  t0 mean_v sd_v st0
## 1 1.25 1.5 0.2    2.5    1   0
## 2 1.25 1.5 0.2    1.5    1   0
## 3 1.25 1.5 0.2    1.2    1   0
## [1] "nn.W"
##      A   b  t0 mean_v sd_v st0
## 1 1.25 1.5 0.2    2.5    1   0
## 2 1.25 1.5 0.2    1.5    1   0
## 3 1.25 1.5 0.2    1.2    1   0
## [1] "pn.W"
##      A   b  t0 mean_v sd_v st0
## 1 1.25 1.5 0.2    2.5    1   0
## 2 1.25 1.5 0.2    1.5    1   0
## 3 1.25 1.5 0.2    1.2    1   0
...

## To see what other options in the simulate function
## ?ggdmc:::simulate
nsim &lt;- 2048
dat &lt;- simulate(model, nsim = nsim, ps = p.vector)
</code></pre></div></div>

<p>We used data.table to inspect the data frame.  This makes no difference when
the data set is small.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>d &lt;- data.table(dat)
dmi &lt;- BuildDMI(dat, model)

## Check the factor levels
sapply(d[, .(S,R)], levels)
##     S    R
## [1,] "ww" "W"
## [2,] "nn" "N"
## [3,] "pn" "P"
</code></pre></div></div>

<p>To inspect the response time distributions, we designated the response proportions for each
of the response types.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ww1 &lt;- d[S == "ww" &amp; R == "W" &amp; RT &lt;= 10, "RT"]
ww1 &lt;- d[S == "ww" &amp; R == "W" &amp; RT &lt;= 10, "RT"]
ww2 &lt;- d[S == "ww" &amp; R == "N" &amp; RT &lt;= 10, "RT"]
ww3 &lt;- d[S == "ww" &amp; R == "P" &amp; RT &lt;= 10, "RT"]
nn1 &lt;- d[S == "nn" &amp; R == "W" &amp; RT &lt;= 10, "RT"]
nn2 &lt;- d[S == "nn" &amp; R == "N" &amp; RT &lt;= 10, "RT"]
nn3 &lt;- d[S == "nn" &amp; R == "P" &amp; RT &lt;= 10, "RT"]
pn1 &lt;- d[S == "pn" &amp; R == "W" &amp; RT &lt;= 10, "RT"]
pn2 &lt;- d[S == "pn" &amp; R == "N" &amp; RT &lt;= 10, "RT"]
pn3 &lt;- d[S == "pn" &amp; R == "P" &amp; RT &lt;= 10, "RT"]

xlim &lt;- c(0, 5)
par(mfrow=c(1, 3), mar = c(4, 4, 0.82, 1))
hist(ww1$RT, breaks = "fd", freq = TRUE, xlim = xlim, main='Word', xlab='RT(s)',
     cex.lab=1.5)
hist(ww2$RT, breaks = "fd", freq = TRUE, add = TRUE, col = "lightblue")
hist(ww3$RT, breaks = "fd", freq = TRUE, add = TRUE, col = "orange")

hist(nn1$RT, breaks = "fd", freq = TRUE, xlim = xlim, main='Non-word', 
     xlab='RT(s)', ylab='', cex.lab=1.5)
hist(nn2$RT, breaks = "fd", freq = TRUE, add = TRUE, col = "lightblue")
hist(nn3$RT, breaks = "fd", freq = TRUE, add = TRUE, col = "orange")

hist(pn1$RT, breaks = "fd", freq = TRUE, xlim = xlim, main='Pseudo-word', 
     xlab='RT(s)', ylab='', cex.lab=1.5)
hist(pn2$RT, breaks = "fd", freq = TRUE, add = TRUE, col = "lightblue")
hist(pn3$RT, breaks = "fd", freq = TRUE, add = TRUE, col = "orange")
par(mfrow=c(1, 1))
</code></pre></div></div>

<h2 id="prior-distribution">Prior distribution</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p.prior &lt;- BuildPrior(
  dists = c("tnorm", "tnorm", "beta", "tnorm", "tnorm", "tnorm"),
  p1    = c(A = .3, B = 1, t0 = 1,
            mean_v.W = 1, mean_v.N = 0, mean_v.P = .1),
  p2    = c(1, 1,   1,  3, 3, 3),
  lower = c(0, 0,   0, NA, NA, NA),
  upper = c(NA, NA, 1, NA, NA, NA))

## Visually check the prior distributions
plot(p.prior, ps = p.vector)
</code></pre></div></div>

<h2 id="sampling">Sampling</h2>
<p>The default number of iteration is 200 for <em>StartNewsamples</em> function.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## ?run to see add and other options in run function
fit0 &lt;- StartNewsamples(dmi, p.prior, thin = 2)
fit  &lt;- run(fit0, thin = 2, block = FALSE)

## gelman function also provide subchain option.
## Note the method to call this option is different
res &lt;- gelman(fit, verbose = TRUE, subchain = 1:3)


## Calculate chains: 1 2 3 
## Multivariate psrf: 
##          Point est. Upper C.I.
## A              1.02       1.08
## B              1.00       1.01
## t0             1.01       1.01
## mean_v.W       1.01       1.03
## mean_v.N       1.01       1.03
## mean_v.P       1.01       1.02


## By convention, most Bayesian inference checks 3 or 4 chains
p1 &lt;- plot(fit)
p2 &lt;- plot(fit, pll=F, den=T)
p3 &lt;- plot(fit, subchain = TRUE)
p4 &lt;- plot(fit, pll=F, den=T, subchain = TRUE)

png(file = "LBA3A-checks.png", 800, 600)
grid.arrange(p1, p2, p3, p4)
dev.off()

</code></pre></div></div>

<p><img src="/images/cognitive-model/LBA3A-checks.png" alt="LBA3A-checks" /></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>es &lt;- effectiveSize(fit, verbose = TRUE)
##        A        B       t0 mean_v.W mean_v.N mean_v.P 
##   843.04   838.92   863.98   828.97   840.93   894.25 

est &lt;- summary(fit, ps = p.vector, verbose = TRUE, recovery = TRUE)
## Recovery summarises only default quantiles: 2.5% 25% 50% 75% 97.5% 
##                     A       B mean_v.N mean_v.P mean_v.W     t0
## True           1.2500  0.2500   1.5000   1.2000   2.5000 0.2000
## 2.5% Estimate  1.1516  0.2153   1.3745   1.0190   2.3058 0.1900
## 50% Estimate   1.2724  0.2495   1.5667   1.2116   2.5075 0.2000
## 97.5% Estimate 1.4053  0.2920   1.7573   1.4070   2.7250 0.2085
## Median-True    0.0224 -0.0005   0.0667   0.0116   0.0075 0.0000

</code></pre></div></div>

<p>The posterior predictive figure shows the data and posterior predictions are 
consistent, confirming the model does work well.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pp &lt;- predict_one(fit, xlim = c(0, 5))

original_data &lt;- fit@dmi@data
dplyr::tbl_df(original_data)
d &lt;- data.table(original_data)

## A different way to check data frame
dplyr::tbl_df(original_data)
d &lt;- data.table(original_data)

## Response proportions
d[, .N, .(S)]
d[, .N/100, .(S, R)]


## Score for the correct and error response
dat$C &lt;- ifelse(dat$S == "ww" &amp; dat$R == "W", "O",
         ifelse(dat$S == "nn" &amp; dat$R == "N", "O",
         ifelse(dat$S == "pn" &amp; dat$R == "P", "O",
         ifelse(dat$S == "ww" &amp; dat$R == "N", "X",
         ifelse(dat$S == "ww" &amp; dat$R == "P", "X",
         ifelse(dat$S == "nn" &amp; dat$R == "W", "X",
         ifelse(dat$S == "nn" &amp; dat$R == "P", "X",
         ifelse(dat$S == "pn" &amp; dat$R == "N", "X",
         ifelse(dat$S == "pn" &amp; dat$R == "W", "X", NA)))))))))

pp$C &lt;- ifelse(pp$S == "ww" &amp; pp$R == "W", "O",
        ifelse(pp$S == "nn" &amp; pp$R == "N", "O",
        ifelse(pp$S == "pn" &amp; pp$R == "P", "O",
        ifelse(pp$S == "ww" &amp; pp$R == "N", "X",
        ifelse(pp$S == "ww" &amp; pp$R == "P", "X",
        ifelse(pp$S == "nn" &amp; pp$R == "W", "X",
        ifelse(pp$S == "nn" &amp; pp$R == "P", "X",
        ifelse(pp$S == "pn" &amp; pp$R == "N", "X",
        ifelse(pp$S == "pn" &amp; pp$R == "W", "X", NA)))))))))


dat0 &lt;- dat
dat0$reps &lt;- NA
dat0$type &lt;- "Data"
pp$reps &lt;- factor(pp$reps)
pp$type &lt;- "Simulation"
combined_data &lt;- rbind(dat0, pp)

dplyr::tbl_df(combined_data)

p1 &lt;- ggplot(combined_data, aes(RT, color = reps, size = type)) +
  geom_freqpoly(binwidth = .10) +
  scale_size_manual(values = c(1, .3)) +
  scale_color_grey(na.value = "black") +
  ylab("Count") +
  facet_grid(S ~ C) +
  theme_bw(base_size = 16) +
  theme(strip.background = element_blank(),
        legend.position="none") 

png(file = "LBA3A.png", 800, 600)
print(p1)
dev.off()

</code></pre></div></div>

<p><img src="/images/cognitive-model/LBA3A.png" alt="LBA3A" /></p>

<h2 id="extending-to-four-or-more-accumulators">Extending to four or more accumulators</h2>

<p>Here is a barebone template of 4 stimuli mapping to 4 responses. This is a 15-parameter model; thus, one should expect it would take up a lot of computation time, especially in fitting hierarchical model. It would save time, if one fits fixed-effect model first, using multiple cores.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">require</span><span class="p">(</span><span class="n">ggdmc</span><span class="p">)</span>
<span class="p">##</span> <span class="n">Assume</span> <span class="n">four</span> <span class="n">stimuli</span> <span class="n">that</span> <span class="n">have</span> <span class="n">a</span> <span class="n">shape</span> <span class="k">and</span> <span class="n">color</span> <span class="p">(</span><span class="n">blue_diamond</span><span class="p">,</span> <span class="n">blue_heart</span><span class="p">,</span> 
<span class="p">##</span> <span class="n">green_diamond</span><span class="p">,</span> <span class="k">and</span> <span class="n">green_heart</span><span class="p">)</span> <span class="p">(</span><span class="n">courtesy</span> <span class="k">of</span> <span class="n">davidt0x</span><span class="p">)</span>
<span class="p">##</span> 
<span class="p">##</span> <span class="n">I</span> <span class="n">assume</span> <span class="n">a</span> <span class="n">difficulty</span> <span class="n">hierarchy</span> <span class="p">(</span><span class="k">with</span> <span class="n">no</span> <span class="n">theoretical</span> <span class="n">basis</span><span class="p">)</span> <span class="p">(</span><span class="k">from</span> <span class="n">easy</span> <span class="k">to</span> <span class="n">hard</span><span class="p">):</span> <span class="n">green_diamond</span> <span class="p">(</span><span class="n">e1</span><span class="p">)</span> <span class="p">&gt;</span> <span class="n">green_heart</span> <span class="p">(</span><span class="n">e2</span><span class="p">)</span> <span class="p">&gt;</span> <span class="n">blue_diamond</span> <span class="p">(</span><span class="n">e3</span><span class="p">)</span> <span class="p">&gt;</span> <span class="n">blue_heart</span> <span class="p">(</span><span class="n">e4</span><span class="p">).</span> <span class="n">I</span> <span class="n">also</span> <span class="n">assume</span> <span class="n">the</span> <span class="n">easier</span> <span class="n">stimulus</span><span class="p">,</span> <span class="n">the</span> <span class="n">higher</span> <span class="n">its</span> <span class="n">drift</span> <span class="n">rate</span> <span class="n">is</span> <span class="k">and</span> <span class="n">the</span> <span class="n">more</span> <span class="n">variable</span> <span class="p">(</span><span class="n">hence</span> <span class="n">the</span> <span class="n">higher</span> <span class="n">value</span><span class="p">)</span> <span class="n">its</span> <span class="n">drift</span> <span class="n">rate</span> <span class="n">standard</span> <span class="n">deviation</span> <span class="n">would</span> <span class="n">be</span><span class="p">.</span> 

<span class="k">model</span> <span class="p">&lt;-</span> <span class="n">BuildModel</span><span class="p">(</span>
    <span class="n">p</span><span class="p">.</span><span class="n">map</span>     <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">A</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">B</span> <span class="p">=</span> <span class="s2">"R"</span><span class="p">,</span> <span class="n">t0</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">mean_v</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"S"</span><span class="p">,</span> <span class="s2">"M"</span><span class="p">),</span>
                     <span class="n">sd_v</span> <span class="p">=</span> <span class="s2">"M"</span><span class="p">,</span> <span class="n">st0</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">),</span>
    <span class="n">match</span><span class="p">.</span><span class="n">map</span> <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">M</span> <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="s2">"blue_diamond"</span> <span class="p">=</span> <span class="s2">"BD"</span><span class="p">,</span> <span class="s2">"blue_heart"</span> <span class="p">=</span> <span class="s2">"BH"</span><span class="p">,</span>
                              <span class="s2">"green_diamond"</span> <span class="p">=</span> <span class="s2">"GD"</span><span class="p">,</span> <span class="s2">"green_heart"</span> <span class="p">=</span> <span class="s2">"GH"</span><span class="p">)),</span>
    <span class="n">factors</span>   <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">S</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"blue_diamond"</span><span class="p">,</span> <span class="s2">"blue_heart"</span><span class="p">,</span> <span class="s2">"green_diamond"</span><span class="p">,</span> <span class="s2">"green_heart"</span><span class="p">)),</span>
    <span class="n">constants</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">sd_v</span><span class="p">.</span><span class="nb">false</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">st0</span> <span class="p">=</span> <span class="m">0</span><span class="p">),</span>
    <span class="n">responses</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"BD"</span><span class="p">,</span> <span class="s2">"BH"</span><span class="p">,</span> <span class="s2">"GD"</span><span class="p">,</span> <span class="s2">"GH"</span><span class="p">),</span>
    <span class="n">type</span>      <span class="p">=</span> <span class="s2">"norm"</span><span class="p">)</span>

<span class="n">pop</span><span class="p">.</span><span class="n">mean</span> <span class="p">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="n">A</span><span class="p">=</span><span class="m">.4</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">BD</span><span class="p">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">BH</span><span class="p">=</span><span class="m">.6</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">GD</span><span class="p">=</span><span class="m">.7</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">GH</span><span class="p">=</span><span class="m">.8</span><span class="p">,</span>
              <span class="n">t0</span><span class="p">=</span><span class="m">.3</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_diamond</span><span class="p">.</span><span class="nb">true</span>   <span class="p">=</span> <span class="m">1.5</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_heart</span><span class="p">.</span><span class="nb">true</span>     <span class="p">=</span> <span class="m">1.0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_diamond</span><span class="p">.</span><span class="nb">true</span>  <span class="p">=</span> <span class="m">2.5</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_heart</span><span class="p">.</span><span class="nb">true</span>    <span class="p">=</span> <span class="m">2.0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_diamond</span><span class="p">.</span><span class="nb">false</span>  <span class="p">=</span> <span class="m">.20</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_heart</span><span class="p">.</span><span class="nb">false</span>    <span class="p">=</span> <span class="m">.25</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_diamond</span><span class="p">.</span><span class="nb">false</span> <span class="p">=</span> <span class="m">.10</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_heart</span><span class="p">.</span><span class="nb">false</span>   <span class="p">=</span> <span class="m">.15</span><span class="p">,</span>
              <span class="n">sd_v</span><span class="p">.</span><span class="nb">true</span> <span class="p">=</span> <span class="m">.25</span><span class="p">)</span>

<span class="n">pop</span><span class="p">.</span><span class="n">scale</span> <span class="p">&lt;-</span><span class="n">c</span><span class="p">(</span><span class="n">A</span><span class="p">=</span><span class="m">.1</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">BD</span><span class="p">=</span><span class="m">.1</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">BH</span><span class="p">=</span><span class="m">.1</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">GD</span><span class="p">=</span><span class="m">.1</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">GH</span><span class="p">=</span><span class="m">.1</span><span class="p">,</span>
              <span class="n">t0</span><span class="p">=</span><span class="m">.05</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_diamond</span><span class="p">.</span><span class="nb">true</span>   <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_heart</span><span class="p">.</span><span class="nb">true</span>     <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_diamond</span><span class="p">.</span><span class="nb">true</span>  <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_heart</span><span class="p">.</span><span class="nb">true</span>    <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_diamond</span><span class="p">.</span><span class="nb">false</span>  <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_heart</span><span class="p">.</span><span class="nb">false</span>    <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_diamond</span><span class="p">.</span><span class="nb">false</span> <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_heart</span><span class="p">.</span><span class="nb">false</span>   <span class="p">=</span> <span class="m">.2</span><span class="p">,</span>
              <span class="n">sd_v</span><span class="p">.</span><span class="nb">true</span> <span class="p">=</span> <span class="m">.1</span><span class="p">)</span>

<span class="n">pop</span><span class="p">.</span><span class="n">prior</span> <span class="p">&lt;-</span> <span class="n">BuildPrior</span><span class="p">(</span>
     <span class="n">dists</span> <span class="p">=</span> <span class="n">rep</span><span class="p">(</span><span class="s2">"tnorm"</span><span class="p">,</span> <span class="k">model</span><span class="p">@</span><span class="n">npar</span><span class="p">),</span>
     <span class="n">p1</span> <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">mean</span><span class="p">,</span>
     <span class="n">p2</span> <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">scale</span><span class="p">,</span>
     <span class="n">lower</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span>        <span class="m">.05</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
    <span class="n">upper</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span>    <span class="m">1</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">))</span>

<span class="p">##</span> <span class="n">plot</span><span class="p">(</span><span class="n">pop</span><span class="p">.</span><span class="n">prior</span><span class="p">)</span>
<span class="p">##</span> <span class="n">Simulate</span> <span class="n">some</span> <span class="n">data</span> <span class="p">----------</span>
<span class="p">##</span> <span class="n">Assume</span> <span class="m">12</span> <span class="n">participants</span><span class="p">,</span> <span class="n">each</span> <span class="n">contributing</span> <span class="m">30</span> <span class="n">trials</span> <span class="n">per</span> <span class="n">condition</span><span class="p">.</span>
<span class="n">dat</span> <span class="p">&lt;-</span> <span class="n">simulate</span><span class="p">(</span><span class="k">model</span><span class="p">,</span> <span class="n">nsub</span> <span class="p">=</span> <span class="m">12</span><span class="p">,</span> <span class="n">nsim</span> <span class="p">=</span> <span class="m">30</span><span class="p">,</span> <span class="n">prior</span> <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">prior</span><span class="p">)</span>
<span class="n">dmi</span> <span class="p">&lt;-</span> <span class="n">BuildDMI</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="k">model</span><span class="p">)</span>
<span class="n">ps</span> <span class="p">&lt;-</span> <span class="n">attr</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="s2">"parameters"</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">prior</span> <span class="p">&lt;-</span> <span class="n">BuildPrior</span><span class="p">(</span>
    <span class="n">dists</span> <span class="p">=</span> <span class="n">rep</span><span class="p">(</span><span class="s2">"tnorm"</span><span class="p">,</span> <span class="k">model</span><span class="p">@</span><span class="n">npar</span><span class="p">),</span>
    <span class="n">p1</span>   <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">mean</span><span class="p">,</span>
    <span class="n">p2</span>   <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">scale</span><span class="p">*</span><span class="m">5</span><span class="p">,</span>
    <span class="n">lower</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span>        <span class="m">.05</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
    <span class="n">upper</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span>    <span class="m">1</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">))</span>

<span class="n">mu</span><span class="p">.</span><span class="n">prior</span> <span class="p">&lt;-</span> <span class="n">BuildPrior</span><span class="p">(</span>
    <span class="n">dists</span> <span class="p">=</span> <span class="n">rep</span><span class="p">(</span><span class="s2">"tnorm"</span><span class="p">,</span>  <span class="k">model</span><span class="p">@</span><span class="n">npar</span><span class="p">),</span>
    <span class="n">p1</span>    <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">mean</span><span class="p">,</span>
    <span class="n">p2</span>    <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>  <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span>
    <span class="n">lower</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span>       <span class="m">.05</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
    <span class="n">upper</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span>    <span class="m">1</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span><span class="n">NA</span><span class="p">,</span> <span class="n">NA</span><span class="p">))</span>

<span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">ps</span><span class="p">=</span><span class="n">ps</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">mu</span><span class="p">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">ps</span> <span class="p">=</span> <span class="n">pop</span><span class="p">.</span><span class="n">mean</span><span class="p">)</span>

<span class="n">sigma</span><span class="p">.</span><span class="n">prior</span> <span class="p">&lt;-</span> <span class="n">BuildPrior</span><span class="p">(</span>
    <span class="n">dists</span> <span class="p">=</span> <span class="n">rep</span><span class="p">(</span><span class="s2">"unif"</span><span class="p">,</span> <span class="k">model</span><span class="p">@</span><span class="n">npar</span><span class="p">),</span>
    <span class="n">p1</span>    <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">A</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">BD</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">BH</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">GD</span><span class="p">=</span><span class="m">0</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">GH</span><span class="p">=</span><span class="m">0</span><span class="p">,</span>
              <span class="n">t0</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_diamond</span><span class="p">.</span><span class="nb">true</span>   <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_heart</span><span class="p">.</span><span class="nb">true</span>     <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_diamond</span><span class="p">.</span><span class="nb">true</span>  <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_heart</span><span class="p">.</span><span class="nb">true</span>    <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_diamond</span><span class="p">.</span><span class="nb">false</span>  <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">blue_heart</span><span class="p">.</span><span class="nb">false</span>    <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_diamond</span><span class="p">.</span><span class="nb">false</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">mean_v</span><span class="p">.</span><span class="n">green_heart</span><span class="p">.</span><span class="nb">false</span>   <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
              <span class="n">sd_v</span><span class="p">.</span><span class="nb">true</span> <span class="p">=</span> <span class="m">0</span><span class="p">),</span>
    <span class="n">p2</span>    <span class="p">=</span> <span class="n">rep</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="k">model</span><span class="p">@</span><span class="n">npar</span><span class="p">))</span>

<span class="p">##</span> <span class="n">plot</span><span class="p">(</span><span class="n">sigma</span><span class="p">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">ps</span><span class="p">=</span><span class="n">pop</span><span class="p">.</span><span class="n">scale</span><span class="p">)</span>
<span class="p">##</span> <span class="n">Sampling</span> <span class="p">-------------</span>
<span class="n">priors</span> <span class="p">&lt;-</span> <span class="k">list</span><span class="p">(</span><span class="n">pprior</span><span class="p">=</span><span class="n">p</span><span class="p">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">location</span><span class="p">=</span><span class="n">mu</span><span class="p">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">scale</span><span class="p">=</span><span class="n">sigma</span><span class="p">.</span><span class="n">prior</span><span class="p">)</span>

<span class="p">##</span> <span class="n">Enter</span> <span class="n">only</span> <span class="n">the</span> <span class="n">participant</span><span class="p">-</span><span class="n">level</span> <span class="n">prior</span> <span class="n">distribution</span> <span class="n">will</span> <span class="n">render</span> <span class="n">the</span> <span class="k">function</span> <span class="k">to</span>
<span class="p">##</span> <span class="nf">run</span> <span class="n">fixed</span><span class="p">-</span><span class="n">effect</span> <span class="k">model</span>
<span class="p">##</span> <span class="n">Use</span> <span class="n">nmc</span> <span class="p">=</span> <span class="m">10</span> <span class="k">to</span> <span class="n">estimate</span> <span class="n">how</span> <span class="n">much</span> <span class="n">time</span> <span class="n">would</span> <span class="n">take</span><span class="p">.</span>
<span class="p">##</span> <span class="m">42.22</span>

<span class="n">fit0</span> <span class="p">&lt;-</span> <span class="n">StartNewsamples</span><span class="p">(</span><span class="n">dmi</span><span class="p">,</span> <span class="n">prior</span><span class="p">=</span><span class="n">p</span><span class="p">.</span><span class="n">prior</span><span class="p">,</span> <span class="n">block</span> <span class="p">=</span> <span class="nb">FALSE</span><span class="p">,</span> <span class="n">ncore</span><span class="p">=</span><span class="m">12</span><span class="p">)</span>  <span class="p">##</span> <span class="n">Fixed</span><span class="p">-</span><span class="n">effect</span> <span class="k">model</span> <span class="n">fit</span>
<span class="n">fit</span>  <span class="p">&lt;-</span> <span class="nf">run</span><span class="p">(</span><span class="n">fit0</span><span class="p">,</span> <span class="n">ncore</span> <span class="p">=</span> <span class="m">12</span><span class="p">,</span> <span class="n">block</span> <span class="p">=</span> <span class="nb">FALSE</span><span class="p">)</span>

<span class="n">hfit0</span> <span class="p">&lt;-</span> <span class="n">StartNewsamples</span><span class="p">(</span><span class="n">dmi</span><span class="p">,</span> <span class="n">prior</span><span class="p">=</span><span class="n">priors</span><span class="p">)</span>  <span class="p">##</span> <span class="n">Random</span><span class="p">-</span><span class="n">effect</span> <span class="k">model</span> <span class="n">fit</span>
<span class="n">hfit</span>  <span class="p">&lt;-</span> <span class="nf">run</span><span class="p">(</span><span class="n">hfit0</span><span class="p">)</span>      <span class="p">##</span> <span class="n">ncore</span> <span class="n">has</span> <span class="n">no</span> <span class="n">effect</span> <span class="k">in</span> <span class="n">hierarchical</span> <span class="n">fit</span>


<span class="p">##</span> <span class="k">Model</span> <span class="n">diagnoses</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">subchain</span><span class="p">=</span><span class="nb">TRUE</span><span class="p">,</span> <span class="n">nsubchain</span><span class="p">=</span><span class="m">3</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">subchain</span><span class="p">=</span><span class="nb">TRUE</span><span class="p">,</span> <span class="n">nsubchain</span><span class="p">=</span><span class="m">2</span><span class="p">)</span>

<span class="n">res</span> <span class="p">&lt;-</span> <span class="n">gelman</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">=</span> <span class="nb">TRUE</span><span class="p">)</span>
<span class="n">res</span> <span class="p">&lt;-</span> <span class="n">gelman</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">=</span> <span class="nb">TRUE</span><span class="p">,</span> <span class="n">subchain</span><span class="p">=</span><span class="m">1</span><span class="p">:</span><span class="m">4</span><span class="p">)</span>
<span class="n">res</span> <span class="p">&lt;-</span> <span class="n">gelman</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">=</span> <span class="nb">TRUE</span><span class="p">,</span> <span class="n">subchain</span><span class="p">=</span><span class="m">5</span><span class="p">:</span><span class="m">8</span><span class="p">)</span>
<span class="n">res</span> <span class="p">&lt;-</span> <span class="n">gelman</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">=</span> <span class="nb">TRUE</span><span class="p">,</span> <span class="n">subchain</span><span class="p">=</span><span class="m">9</span><span class="p">:</span><span class="m">12</span><span class="p">)</span>

<span class="p">##</span> <span class="n">Check</span> <span class="k">if</span> <span class="n">parameter</span> <span class="n">recovery</span> <span class="n">well</span> <span class="k">in</span> <span class="n">fixed</span><span class="p">-</span><span class="n">effect</span> <span class="k">model</span> <span class="n">fit</span>
<span class="n">est0</span> <span class="p">&lt;-</span> <span class="n">summary</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">recovery</span> <span class="p">=</span> <span class="nb">TRUE</span><span class="p">,</span> <span class="n">ps</span> <span class="p">=</span> <span class="n">ps</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">=</span><span class="nb">TRUE</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="how-to-fix-array-dimension-inconsistency">How to fix array dimension inconsistency</h2>
<p>If data were stored by a previous version of ggdmc or by DMC, their arraies
are arranged differently as noted <a href="https://github.com/yxlin/ggdmc">here</a>. The 
following is one convenient way to transpose them.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## First make sure they are indeed needed to be transposed
dim(fit0@theta)
dim(fit0@summed_log_prior)
dim(fit0@log_likelihoods)

dim(fit0$theta)
dim(fit0$summed_log_prior)
dim(fit0$log_likelihoods)

## Use aperm and t to transpose arrays and matrices
fit0@theta &lt;- aperm(fit0@theta, c(2, 1, 3))
fit0@summed_log_prior &lt;- t(fit0@summed_log_prior)
fit0@log_likelihoods &lt;- t(fit0@log_likelihoods)

## Make the new object a posterior class
class(fit0) &lt;- c("posterior")

</code></pre></div></div>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});

			
		</script>

		  
		</script>
	</body>
</html>

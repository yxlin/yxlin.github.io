<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Begin Jekyll SEO tag v2.4.0 -->
<title>CDDM | Cognitive Models</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="CDDM" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Disclaimer: We have striven to minimize the number of errors. However, we cannot guarantee the note is 100% accurate. This note records the codes for fitting fixed-effect 2-D diffusion model." />
<meta property="og:description" content="Disclaimer: We have striven to minimize the number of errors. However, we cannot guarantee the note is 100% accurate. This note records the codes for fitting fixed-effect 2-D diffusion model." />
<link rel="canonical" href="http://localhost:4000/fixed-effect-model/cddm12S/" />
<meta property="og:url" content="http://localhost:4000/fixed-effect-model/cddm12S/" />
<meta property="og:site_name" content="Cognitive Models" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-10-10T09:40:41+00:00" />
<script type="application/ld+json">
{"datePublished":"2019-10-10T09:40:41+00:00","description":"Disclaimer: We have striven to minimize the number of errors. However, we cannot guarantee the note is 100% accurate. This note records the codes for fitting fixed-effect 2-D diffusion model.","@type":"Article","url":"http://localhost:4000/fixed-effect-model/cddm12S/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/siteicon.png"}},"headline":"CDDM","dateModified":"2019-10-10T09:40:41+00:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Cognitive Models" />

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		
	</head>

	<body>
	  <header>
	    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML"></script>
	    
			<h1>
				<a href="/"><img src="/images/emblem.svg" width="40" height="40" alt="Cognitive Models logo"></a>
				Cognitive Models
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav >
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/"></a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/BUGS/hnormal/">BUGS Examples Volumn 1</a>
							<ul>
								
									<li class="nav-item "><a href="/BUGS/hnormal/">Hierarchical Normal Model</a></li>
								
									<li class="nav-item "><a href="/BUGS/seeds/">Random effect logistic regression</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/approximation/kde/">Likelihood Free Method</a>
							<ul>
								
									<li class="nav-item "><a href="/approximation/kde/">Kernel Density Estimation</a></li>
								
									<li class="nav-item "><a href="/approximation/pda/">Probability Density Approximation</a></li>
								
									<li class="nav-item "><a href="/approximation/ppda/">Parallel Probability Density Approximation</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/basics/model_array/">Modelling Basics</a>
							<ul>
								
									<li class="nav-item "><a href="/basics/model_array/">Model Array</a></li>
								
									<li class="nav-item "><a href="/basics/simulation/">Simulation</a></li>
								
									<li class="nav-item "><a href="/basics/descriptive/">Descriptive Statistics</a></li>
								
									<li class="nav-item "><a href="/basics/summary/">Summary Statistics</a></li>
								
									<li class="nav-item "><a href="/basics/mle/">Maximising Likelihoods</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/bayes-basics/theorem/">Bayesian Basics</a>
							<ul>
								
									<li class="nav-item "><a href="/bayes-basics/theorem/">Bayes' Theorem</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/prior/">Prior Distribution</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/likelihood/">Model Likelihood</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/posterior/">Posterior Distribution</a></li>
								
									<li class="nav-item "><a href="/bayes-basics/diagnosis/">Checking Fitted Models</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/cognitive-model/lba/">Cognitive Model</a>
							<ul>
								
									<li class="nav-item "><a href="/cognitive-model/lba/">LBA Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/pm/">PM Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/plba/">PLBA Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/ddm/">Diffusion Decision Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/cddm/">Circular Drift-diffusion Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/pddm/">PDDM</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/lba3/">Three-accumulator LBA Model</a></li>
								
									<li class="nav-item "><a href="/cognitive-model/lca/">LCA Model</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level current">
							
							<a href="/fixed-effect-model/one_participant/">Fixed-effects Model</a>
							<ul>
								
									<li class="nav-item "><a href="/fixed-effect-model/one_participant/">One Participant</a></li>
								
									<li class="nav-item "><a href="/fixed-effect-model/many_participants/">Multiple Participants</a></li>
								
									<li class="nav-item current"><a href="/fixed-effect-model/cddm12S/">CDDM</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/mcmc/mcmc/">Modern Bayesian Statistics</a>
							<ul>
								
									<li class="nav-item "><a href="/mcmc/mcmc/">Markov Chain Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/mcmc/rwm/">Random Walk Metropolis</a></li>
								
									<li class="nav-item "><a href="/mcmc/hastings/">Metropolis-Hastings</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/random-effect-model/hlba/">Hierarchical Model</a>
							<ul>
								
									<li class="nav-item "><a href="/random-effect-model/hlba/">HLBA Model</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/hddm/">HDDM</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/shooting-decision1/">Shooting Decision Model - Recovery Study</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/shooting-decision2/">Shooting Decision Model - Empirical Data</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/hcddm/">HCDDM</a></li>
								
									<li class="nav-item "><a href="/random-effect-model/hpm/">HPM Model</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/sampling/genetic/">Sampling Techniques</a>
							<ul>
								
									<li class="nav-item "><a href="/sampling/genetic/">Population-based Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/sampling/crossover/">Crossover</a></li>
								
									<li class="nav-item "><a href="/sampling/migration/">Migration</a></li>
								
									<li class="nav-item "><a href="/sampling/mutation/">Mutation</a></li>
								
									<li class="nav-item "><a href="/sampling/demc/">Differential Evolution Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/sampling/demcmc/">Differential Evolution Markov Chain Monte Carlo</a></li>
								
									<li class="nav-item "><a href="/sampling/dgmc/">Distributed Genetic Monte Carlo</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>Fixed-effects Model</h2>
				<h3>CDDM</h3>
			</div>
			<article class="content">
				<blockquote>
  <p><strong>Disclaimer</strong>: We have striven to minimize the number of errors. However, we cannot guarantee the note is 100% accurate. This note records the codes for fitting fixed-effect 2-D diffusion model.</p>
</blockquote>

<p>In this tutorial, we conducted a parameter recovery of a CDDM associating a speed-and-accuracy (SAT) factor with the threshold parameter, <em>a</em>. A classic SAT experiment usually encourages participants to emphaize response speed in one condition and response accuracy in the other.  The SAT factor is often found selectively affecting threshold-related parameters in 1-D diffusion model.</p>

<p>The model description prepares for a design with two factors: a three-level stimulus factor (S) and a two-level speed-and-accuracy (SAT) factor. However, it assumes only the threshold parameter, <em>a</em> is affected by the SAT factor and the S factor is inconseuqntial.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">##</span> <span class="n">This</span> <span class="n">cleans</span> <span class="n">up</span> <span class="n">objects</span> <span class="k">in</span> <span class="n">the</span> <span class="n">workspace</span><span class="p">,</span> <span class="n">but</span> <span class="n">already</span><span class="p">-</span><span class="n">loaded</span> <span class="n">pacakges</span> <span class="n">will</span> <span class="n">be</span> 
<span class="p">##</span> <span class="n">stilled</span> <span class="n">loaded</span><span class="p">.</span> <span class="k">To</span> <span class="n">get</span> <span class="n">a</span> <span class="n">clear</span> <span class="n">start</span> <span class="k">of</span> <span class="n">an</span> <span class="n">R</span> <span class="n">session</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="n">hot</span><span class="p">-</span><span class="n">key</span> <span class="n">Ctrl</span><span class="p">-</span><span class="n">Shift</span><span class="p">-</span><span class="n">F10</span> 
<span class="p">##</span> <span class="k">in</span> <span class="n">RStudio</span> <span class="n">for</span> <span class="n">instance</span><span class="p">.</span>
<span class="n">rm</span><span class="p">(</span><span class="k">list</span> <span class="p">=</span> <span class="n">ls</span><span class="p">())</span>   
<span class="n">require</span><span class="p">(</span><span class="n">ggdmc</span><span class="p">)</span>

<span class="n">nw</span> <span class="p">&lt;-</span> <span class="m">4</span>  
<span class="k">model</span> <span class="p">&lt;-</span> <span class="n">BuildModel</span><span class="p">(</span>
  <span class="n">p</span><span class="p">.</span><span class="n">map</span>     <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">v1</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">v2</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">a</span> <span class="p">=</span> <span class="s2">"SAT"</span><span class="p">,</span> <span class="n">t0</span> <span class="p">=</span> <span class="s2">"1"</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">=</span><span class="s2">"1"</span><span class="p">,</span>
                   <span class="n">sigma2</span><span class="p">=</span><span class="s2">"1"</span><span class="p">,</span> <span class="n">eta1</span><span class="p">=</span><span class="s2">"1"</span><span class="p">,</span> <span class="n">eta2</span><span class="p">=</span><span class="s2">"1"</span><span class="p">,</span> <span class="n">tmax</span><span class="p">=</span><span class="s2">"1"</span><span class="p">,</span> <span class="n">h</span><span class="p">=</span><span class="s2">"1"</span><span class="p">),</span>
  <span class="n">match</span><span class="p">.</span><span class="n">map</span> <span class="p">=</span> <span class="n">NULL</span><span class="p">,</span>
  <span class="n">constants</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="n">sigma1</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">sigma2</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">eta1</span><span class="p">=</span><span class="m">0</span><span class="p">,</span> <span class="n">eta2</span><span class="p">=</span><span class="m">0</span><span class="p">,</span> <span class="n">tmax</span><span class="p">=</span><span class="m">3</span><span class="p">,</span> <span class="n">h</span><span class="p">=</span><span class="m">1e-4</span><span class="p">),</span>
  <span class="n">factors</span>   <span class="p">=</span> <span class="k">list</span><span class="p">(</span><span class="n">S</span> <span class="p">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"s1"</span><span class="p">,</span> <span class="s2">"s2"</span><span class="p">,</span> <span class="s2">"s3"</span><span class="p">),</span> <span class="n">SAT</span><span class="p">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"speed"</span><span class="p">,</span> <span class="s2">"accuracy"</span><span class="p">)),</span>
  <span class="n">responses</span> <span class="p">=</span> <span class="n">paste0</span><span class="p">(</span><span class="s1">'theta_'</span><span class="p">,</span> <span class="n">letters</span><span class="p">[</span><span class="m">1</span><span class="p">:</span><span class="n">nw</span><span class="p">]),</span>
  <span class="n">type</span>      <span class="p">=</span> <span class="s2">"cddm"</span><span class="p">)</span>
<span class="n">npar</span> <span class="p">&lt;-</span> <span class="n">length</span><span class="p">(</span><span class="n">GetPNames</span><span class="p">(</span><span class="k">model</span><span class="p">))</span>
</code></pre></div></div>

<p>In the following, we set up an assumed mechanism to generate twelve sets of true parameters, inside the <em>simulate</em> function. The true parameters are stored as a <em>ps</em> matrix, an  attribute attached to the output object from the <em>simulate</em> function. Each row of the <em>ps</em> matrix represents one participant.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pop.mean  &lt;- c(v1=1.2, v2=2.2, a.speed = 1.5, a.accuracy = 2.0, t0=0.1)
pop.scale &lt;- c(v1=2.5, v2=2.5, a.speed=2,     a.accuracy=2.0,   t0=0.5)

pop.prior &lt;- BuildPrior(
  dists = rep("tnorm", npar),
  p1    = pop.mean,
  p2    = pop.scale,
  lower = c(rep(-5, 2), 0, 0, 0),
  upper = c(rep( 5, 2), 5, 5, 2))


dat &lt;- simulate(model, nsub=12, nsim = 30, prior = pop.prior);
ps  &lt;- attr(dat, "parameters")
dmi &lt;- BuildDMI(dat, model)

</code></pre></div></div>

<p>We then set up prior distributions for each CDDM parameter. Before we proceed to fit the data, we check whether our prior distributions cover the all true target parameters.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>p.prior &lt;- BuildPrior(
  dists = rep("tnorm", npar),
  p1    = pop.mean,
  p2    = pop.scale,
  lower = c(rep(-10, 2), 0, 0, 0),
  upper = c(rep( 10, 2), 8, 8, 5))

prior_d &lt;- plot(p.prior, save = TRUE)

wide &lt;- data.table::data.table(ps)
wide$s &lt;- factor(1:nrow(ps))
pveclines &lt;- data.table::melt.data.table(
  wide, id.vars = "s", variable.name = "Parameter", value.name = "true")

## require(ggplot2)
p0 &lt;- ggplot(prior_d, aes_string(x = "xpos", y = "ypos")) +
  geom_line() +
  geom_vline(data = pveclines, aes_string(xintercept = "true"),
             linetype = "dotted", size = 1) +
  xlab("")+ ylab("")+
  facet_wrap(~Parameter, scales="free") +
  theme_bw() +
  theme(legend.position = "none",
        strip.text.x = element_text(size = 16),
        strip.text.y = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_text(size = 16),
        axis.text.y = element_text(size = 16),
        axis.title.x = element_blank())

</code></pre></div></div>

<p><img src="/images/fixed-effect-model/prior_cddm.png" alt="prior" /></p>

<p>Then we use 3 CPU cores, <strong>ncore=3</strong> to run 3 parallel model fits. The <strong>block</strong> option indicates whether we want to update the entire parameter vector or just one parameter in the vector at a time. This is critical for the hierarchical model fit, but inconsequential for the fixed-effect model fit, so to gain more speed, we choose to disable it, <strong>block=FALSE</strong>.</p>

<blockquote>
  <p>Note in R 3.6.1, the <strong>mc.cores</strong> option in <strong>mclapply</strong> has been altered. It now takes the ncore option via “getOpion(“mc.cores”, 2L)”. This renders the ggdmc 0.2.6.0 always run 2 cores, which is a default setting of the mclapply function. To launch the number of CPU core you want, you have to adjust this manually in the two internal R functions, <strong>run_many</strong> and <strong>rerun_many</strong>, accordingly, or update your ggdmc via devtool tools.</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## The latest ggdmc 0.2.7.1 will report its processing time! 
## Processing time: 214.3 secs.
fit0 &lt;- StartNewsamples(dmi, p.prior, block=FALSE, ncore=3)

## Processing time: 611.43 secs.
fit  &lt;- run(fit0, block=FALSE, ncore=3)

</code></pre></div></div>

<p>After finishing the model fit, we check whether the chains are converged. The potential scale reduction factors, PSRT, are all below well 1.10.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rhat &lt;- gelman(fit, verbose=TRUE)
# Diagnosing theta for many participants separately
# Mean    5    3   10    7    1    4    2   11    8   12    6    9 
# 1.02 1.01 1.01 1.01 1.01 1.01 1.01 1.01 1.02 1.02 1.02 1.03 1.10 

est &lt;- summary(fit, recovery = TRUE, ps = ps, verbose = FALSE)
</code></pre></div></div>

<p>Plus, the parameters are precisely recovered.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Summary each participant separately
#         v1    v2     a   t0
# Mean  1.98  1.92  1.52 0.12
# True  1.98  2.01  1.49 0.12
# Diff  0.00  0.10 -0.03 0.00
# Sd    0.14  0.17  0.12 0.04
# True  0.08  0.09  0.07 0.04
# Diff -0.06 -0.08 -0.05 0.00
</code></pre></div></div>


			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});

			
		</script>

		  
		</script>
	</body>
</html>
